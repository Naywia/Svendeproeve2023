using Arkaeologigalleriet.Models;
using Arkaeologigalleriet.Views;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Media;
using Newtonsoft.Json;
using System.Diagnostics;
using System.Net.Http.Headers;

namespace Arkaeologigalleriet.ViewModels
{
    [QueryProperty(nameof(ArtifactID), nameof(ArtifactID))]
    public partial class ArtifactInformationViewModel : ObservableObject
    {
        #region Propyties

        
        HttpClient _client;
        //string _url = "http://192.168.1.100:8000/";
        string _url = "http://164.68.113.72:8000/";

        [ObservableProperty]
        Artefact _artifactModel;

        [ObservableProperty]
        int _artifactID;

        [ObservableProperty]
        ImageSource _imageSource;

        CancellationTokenSource _cts;

    

        #endregion

        public ArtifactInformationViewModel()
        {
        }


        #region ApiCall

        
        public async Task<Artefact> GetArtifact()
        {
            ArtifactModel = new Artefact();
            _client = new HttpClient();

            try
            {
                using HttpRequestMessage request = new HttpRequestMessage(HttpMethod.Get, _url + "artefact?artefactID=" + ArtifactID);
                request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", await SecureStorage.Default.GetAsync("JWT"));
                HttpResponseMessage response = await _client.SendAsync(request);
                if (response.IsSuccessStatusCode)
                {
                    string payload = await response.Content.ReadAsStringAsync();
                    try
                    {

                        var jsonModel = JsonConvert.DeserializeObject<ArtifactInformationModel>(payload);
                        ArtifactModel = jsonModel.Artefact.FirstOrDefault();
                        
                        if (!string.IsNullOrEmpty(ArtifactModel.ArtefactImage))
                        {
                            MemoryStream stream = new(Convert.FromBase64String(ArtifactModel.ArtefactImage));
                            ImageSource = ImageSource.FromStream(() => stream);
                        }
                        else
                        {
                            MemoryStream stream = new(Convert.FromBase64String("/9j/4AAQSkZJRgABAQEBLAEsAAD/4QBWRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAAEsAAAAAQAAASwAAAAB/+0ALFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAQAAAgAEAP/hDIFodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvADw/eHBhY2tldCBiZWdpbj0n77u/JyBpZD0nVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkJz8+Cjx4OnhtcG1ldGEgeG1sbnM6eD0nYWRvYmU6bnM6bWV0YS8nIHg6eG1wdGs9J0ltYWdlOjpFeGlmVG9vbCAxMC4xMCc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp0aWZmPSdodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyc+CiAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICA8dGlmZjpYUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpYUmVzb2x1dGlvbj4KICA8dGlmZjpZUmVzb2x1dGlvbj4zMDAvMTwvdGlmZjpZUmVzb2x1dGlvbj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wTU09J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8nPgogIDx4bXBNTTpEb2N1bWVudElEPmFkb2JlOmRvY2lkOnN0b2NrOjVjMWZlY2Q3LTY4ZDUtNDJiMS1hNWJkLTE5Yjg2MTMyMTc1YjwveG1wTU06RG9jdW1lbnRJRD4KICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjk2NGNkMmY3LTY1OTYtNGI2NS1iZmFiLTkyYWM2OWRhNTc5ZDwveG1wTU06SW5zdGFuY2VJRD4KIDwvcmRmOkRlc2NyaXB0aW9uPgo8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSd3Jz8+/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgA8ADwAwERAAIRAQMRAf/EAB0AAQACAwEBAQEAAAAAAAAAAAAHCAUGCQMEAQL/xABTEAABAwMCAwQCDQULCwUBAAABAAIDBAUGBxEIEiETMUFhFFEYIjI3QlZxdYGRobHSFSNS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"));
                            ImageSource = ImageSource.FromStream(() => stream);
                        }
                        

                    }
                    catch (Exception ex)
                    {
                        Console.Out.WriteLine(ex.Message);
                        throw;
                    }
                    return ArtifactModel;
                }
            }
            catch (Exception ex)
            {
                Console.Out.WriteLine(ex.Message);
                throw;
            }

            return null;

        }
        #endregion

        [RelayCommand]
        public async Task SpeakNowAsync()
        {
            _cts = new CancellationTokenSource();

            IEnumerable<Locale> locales = await TextToSpeech.GetLocalesAsync();

            foreach (Locale locale in locales)
            {
                await Console.Out.WriteLineAsync(locale.Language);
            }


            SpeechOptions options = new SpeechOptions()
            {
                Pitch = 1.0f,   // 0.0 - 2.0
                Volume = 0.75f, // 0.0 - 1.0
            };

            await TextToSpeech.Default.SpeakAsync(ArtifactModel.Description, options, cancelToken: _cts.Token);

           
        }

        
        public void CancelSpeech()
        {
            if (_cts?.IsCancellationRequested ?? true)
                return;

            _cts.Cancel();
        }

        [RelayCommand]
        public async void NavigateToUpdate()
        {
            await Shell.Current.GoToAsync($"{nameof(UpdateStatusView)}?ArtifactID={ArtifactID}");
        }
    }
}
